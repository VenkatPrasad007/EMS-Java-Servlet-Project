<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Dashboard - EMS</title>
<style>
body {
	font-family: 'Segoe UI', sans-serif;
	margin: 0;
	padding: 0;
	background-color: #f4f6f9;
}
header, footer {
	background-color: #004080;
	color: white;
	padding: 1rem 2rem;
	text-align: center;
}

h1 {
	margin: 1rem 0;
}

table {
	width: 95%;
	margin: 2rem auto;
	border-collapse: collapse;
	background-color: white;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

th, td {
	padding: 0.75rem;
	border: 1px solid #ccc;
	text-align: center;
}

th {
	background-color: #004080;
	color: white;
}

button {
	padding: 0.4rem 0.8rem;
	margin: 0.2rem;
	border: none;
	border-radius: 4px;
	cursor: pointer;
	font-weight: bold;
}

.edit-btn {
	background-color: #28a745;
	color: white;
}

.delete-btn {
	background-color: #dc3545;
	color: white;
}

.save-btn {
	background-color: #007bff;
	color: white;
}

.cancel-btn {
	background-color: #6c757d;
	color: white;
}

.add-form {
	width: 95%;
	margin: 2rem auto;
	background-color: white;
	padding: 1rem;
	border-radius: 8px;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

.add-form h2 {
	color: #004080;
}

.add-form input {
	padding: 0.5rem;
	margin: 0.5rem;
	width: 200px;
}

.add-form button {
	margin-top: 1rem;
}

 #logout {
  
  margin-top: 1.5rem;
  padding: 0.75rem 1.5rem;
  background-color: #ffcc00;
  color: #000;
  text-decoration: none;
  font-weight: bold;
  border-radius: 5px;
}
</style>
</head>
<body>
	<header>
		<h1>Admin Dashboard - Employee Management</h1>
		<a href="logout" id="logout" >Logout</a>
	</header>

	<div class="add-form">
		<h2>Add New Employee</h2>
		<input type="text" id="employeeName" placeholder="Name" /> <input
			type="email" id="email" placeholder="Email" /> <input type="text"
			id="mobile" placeholder="Mobile" /> <input type="text" id="gender"
			placeholder="Gender" /> <input type="text" id="department"
			placeholder="Department" /> <input type="text" id="designation"
			placeholder="Designation" /> <input type="number" id="salary"
			placeholder="Salary" /> <input type="date" id="doj"
			placeholder="Date of Joining" /> <input type="text" id="role"
			placeholder="Role" /> <br />
		<button class="save-btn" onclick="addEmployee()">Add Employee</button>
	</div>

	<table id="employeeTable">
		<thead>
			<tr>
				<th>Employee ID</th>
				<th>Name</th>
				<th>Email</th>
				<th>Mobile</th>
				<th>Gender</th>
				<th>Department</th>
				<th>Designation</th>
				<th>Salary</th>
				<th>DOJ</th>
				<th>Role</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>

	<footer>
		<p>&copy; 2025 EMS Admin Panel</p>
	</footer>
	<script>
window.onload = () => {
  fetch("http://localhost:8080/EMS/api/fetchAll")
    .then(resp => resp.json())
    .then(res => {
      if (res.status === "success") {
        const tbody = document.querySelector("#employeeTable tbody");
        res.employees.forEach(emp => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${emp.employeeId}</td>
            <td>${emp.ename}</td>
            <td>${emp.email}</td>
            <td>${emp.mobile}</td>
            <td>${emp.gender}</td>
            <td>${emp.department}</td>
            <td>${emp.designation}</td>
            <td>${emp.salary}</td>
            <td>${emp.doj}</td>
            <td>${emp.role}</td>
            <td>
              <button class="edit-btn" onclick="editRow(this)">Edit</button>
              <button class="delete-btn" onclick="deleteRow('${emp.employeeId}', this)">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      } else {
        alert("Failed to load employees.");
      }
    })
    .catch(err => {
      console.error("Fetch error:", err);
      alert("Server error.");
    });
};

function editRow(button) {
  const row = button.closest("tr");
  const cells = row.querySelectorAll("td");

  for (let i = 1; i <= 9; i++) {
    const value = cells[i].textContent;
    const input = document.createElement("input");
    input.value = value;
    cells[i].innerHTML = "";
    cells[i].appendChild(input);
  }

  button.textContent = "Save";
  button.className = "save-btn";
  button.onclick = () => saveRow(button);

  const cancelBtn = document.createElement("button");
  cancelBtn.textContent = "Cancel";
  cancelBtn.className = "cancel-btn";
  cancelBtn.onclick = () => location.reload();
  button.after(cancelBtn);
}

function saveRow(button) {
  const row = button.closest("tr");
  const employeeId = row.children[0].textContent;
  const inputs = row.querySelectorAll("input");

  const updated = {
    employeeId: employeeId,
    employeeName: inputs[0].value,
    email: inputs[1].value,
    mobile: inputs[2].value,
    gender: inputs[3].value,
    department: inputs[4].value,
    designation: inputs[5].value,
    salary: inputs[6].value,
    doj: inputs[7].value,
    role: inputs[8].value
  };

  const formData = new URLSearchParams();
  for (const key in updated) {
    formData.append(key, updated[key]);
  }

  fetch("http://localhost:8080/EMS/api/updateEmp", {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: formData.toString()
  })
  .then(resp => resp.json())
  .then(res => {
    if (res.status === "success") {
      alert("Employee updated successfully.");
      location.reload();
    } else {
      alert("Update failed.");
    }
  })
  .catch(err => {
    console.error("Update error:", err);
    alert("Server error.");
  });
}

function deleteRow(employeeId, button) {
  if (!confirm("Are you sure you want to delete this employee?")) return;

  const formData = new URLSearchParams();
  formData.append("employeeId", employeeId);

  fetch("http://localhost:8080/EMS/api/deleteUser", {
    method: "post",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: formData.toString()
  })
  .then(resp => resp.json())
  .then(res => {
    if (res.status === "success") {
      alert("Employee deleted.");
      button.closest("tr").remove();
    } else {
      alert("Delete failed.");
    }
  })
  .catch(err => {
    console.error("Delete error:", err);
    alert("Server error.");
  });
}

function addEmployee() {
  const formData = new URLSearchParams();
  formData.append("employeeName", document.getElementById("employeeName").value);
  formData.append("email", document.getElementById("email").value);
  formData.append("mobile", document.getElementById("mobile").value);
  formData.append("gender", document.getElementById("gender").value);
  formData.append("department", document.getElementById("department").value);
  formData.append("designation", document.getElementById("designation").value);
  formData.append("salary", document.getElementById("salary").value);
  formData.append("doj", document.getElementById("doj").value);
  formData.append("role", document.getElementById("role").value);

  fetch("http://localhost:8080/EMS/api/addEmp", {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded"
    },
    body: formData.toString()
  })
  .then(resp => resp.json())
  .then(res => {
    if (res.status === "success") {
      alert("Employee added successfully.");
      location.reload();
    } else {
      alert("Add failed: " + res.message);
    }
  })
  .catch(err => {
    console.error("Add error:", err);
    alert("Server error.");
  });
}

document.getElementById("logout").addEventListener("click", function (event) {
    event.preventDefault(); // Prevent default link navigation

    try {
      // Clear all localStorage data
      localStorage.clear();

      // Optionally, clear only specific keys:
      // localStorage.removeItem("token");

      alert("You have been logged out.");

      // Redirect to login page
      window.location.href = "login.html";
    } catch (err) {
      console.error("Error clearing localStorage:", err);
    }
  });
</script>
</body>
</html>